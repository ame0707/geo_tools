#!/bin/bash
in_dir=$1 
out_dir=$2

## h10v04 UL: -8895604.1573329996317625 5559752.5983330002054572 LR: -7783653.6376670002937317 4447802.0786669999361038
## h11v04 UL: -7783653.6376670002937317 5559752.5983330002054572 LR: -6671703.1179999997839332 4447802.0786669999361038
## h12v04 UL: -6671703.1179999997839332 5559752.5983330002054572 LR: -5559752.5983330002054572 4447802.0786669999361038
## h13v04 UL: -5559752.5983330002054572 5559752.5983330002054572 LR: -4447802.0786669999361038 4447802.0786669999361038 
## h15v02 UL: -3335851.5589999998919666 7783653.6376670002937317 LR: -2223901.0393329998478293 6671703.1179999997839332
## h16v00 UL: -2223901.0393329998478293 10007554.6769999992102385 LR: -1111950.5196670000441372 8895604.1573329996317625 
## h16v01 UL: -2223901.0393329998478293 8895604.1573329996317625 LR: -1111950.5196670000441372 7783653.6376670002937317
## h16v02 UL: -2223901.0393329998478293 7783653.6376670002937317 LR: -1111950.5196670000441372 6671703.1179999997839332


srs_str="+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181 +b=6371007.181 +units=m +no_defs"

if [ ! -d ${out_dir} ]; then
    mkdir ${out_dir}
fi


for hdf in $in_dir/*.hdf
do
    echo $hdf
    case $hdf in
	*h15v02*)
	    echo "Tile h15v02 detected."
	    ul_coord='-3335851.5589999998919666 7783653.6376670002937317'
	    lr_coord='-2223901.0393329998478293 6671703.1179999997839332'
	    ;;
	*h16v00*)
	    echo "Tile h16v00 detected."
	    ul_coord='-2223901.0393329998478293 10007554.6769999992102385'
	    lr_coord='-1111950.5196670000441372 8895604.1573329996317625'
	    ;;
	*h16v01*)
	    echo "Tile h16v01 detected."
	    ul_coord='-2223901.0393329998478293 8895604.1573329996317625'
	    lr_coord='-1111950.5196670000441372 7783653.6376670002937317'
	    ;;
	*h16v02*)
	    echo "Tile h16v02 detected."
	    ul_coord='-2223901.0393329998478293 7783653.6376670002937317'
	    lr_coord='-1111950.5196670000441372 6671703.1179999997839332'
	    ;;
	*)
	    echo "Tile not found! Please open script and define bounding coords."
	    ul_coord=''
	    lr_coord=''
	    ;;
    esac

    filename=$(basename -- $hdf)
    extension="${filename##*.}"
    filename_bare="${filename%.*}"
    gdal_translate -a_nodata 32767 -a_srs "${srs_str}" -a_nodata 32767 -a_ullr ${ul_coord} ${lr_coord} -of GTiff HDF4_SDS:UNKNOWN:"${in_dir}${filename}":9 ${out_dir}/${filename_bare}_sw_blue_sky_albedo.tif
done
